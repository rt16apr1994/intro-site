<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sahayta - Connect & Grow</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .gradient-bg { background: linear-gradient(135deg, #1e3a8a 0%, #3b82f6 100%); }
        input:invalid, textarea:invalid { border-color: #ef4444; }
    </style>
</head>
<body class="bg-slate-50">

    <header class="gradient-bg text-white py-16 px-6 text-center shadow-lg">
        <h1 class="text-4xl md:text-5xl font-extrabold mb-4">Sahayta Portal</h1>
        <p class="text-lg text-blue-100">Connecting Voices, Building Confidence.</p>
    </header>

    <section id="form-section" class="py-12 px-6">
        <div class="max-w-xl mx-auto bg-white p-8 rounded-3xl shadow-2xl border border-slate-100">
            <h2 class="text-2xl font-bold text-slate-800 mb-6 text-center">Register Securely</h2>

            <form id="sahaytaForm" novalidate>
                <div class="space-y-5">
                    <div>
                        <label class="block text-sm font-semibold text-slate-700 mb-1">Select Your Role*</label>
                        <select name="Role" id="role" required class="w-full p-3 border rounded-xl bg-white focus:ring-2 focus:ring-blue-500 outline-none">
                            <option value="">-- Choose Role --</option>
                            <option value="Learner">I need help with my communication</option>
                            <option value="Expert">I want to help/train others</option>
                        </select>
                    </div>

                    <div id="formFields" class="hidden space-y-4">
                        <div>
                            <label class="block text-sm font-semibold text-slate-700 mb-1">Full Name (Max 50 chars)*</label>
                            <input type="text" name="Name" id="name" required maxlength="50" pattern="^[A-Za-z\s]+$" 
                                placeholder="John Doe" 
                                class="w-full p-3 border rounded-xl outline-none focus:ring-2 focus:ring-blue-500">
                            <p class="text-xs text-red-500 mt-1 hidden" id="nameError">Only letters allowed.</p>
                        </div>

                        <div>
                            <label class="block text-sm font-semibold text-slate-700 mb-1">Contact Number (10 Digits)*</label>
                            <input type="tel" name="Contact" id="contact" required pattern="[0-9]{10}" maxlength="10"
                                placeholder="98XXXXXXXX" 
                                class="w-full p-3 border rounded-xl outline-none focus:ring-2 focus:ring-blue-500"
                                oninput="this.value = this.value.replace(/[^0-9]/g, '')">
                            <p class="text-xs text-red-500 mt-1 hidden" id="contactError">Enter exactly 10 digits.</p>
                        </div>

                        <div>
                            <label class="block text-sm font-semibold text-slate-700 mb-1">Email ID*</label>
                            <input type="email" name="Email" id="email" required 
                                placeholder="example@mail.com" 
                                class="w-full p-3 border rounded-xl outline-none focus:ring-2 focus:ring-blue-500">
                        </div>

                        <div>
                            <div class="flex justify-between">
                                <label class="block text-sm font-semibold text-slate-700 mb-1" id="detailLabel">Details*</label>
                                <span class="text-xs text-slate-400" id="charCount">0 / 500</span>
                            </div>
                            <textarea name="Detail" id="detail" rows="4" required maxlength="500" 
                                class="w-full p-3 border rounded-xl outline-none focus:ring-2 focus:ring-blue-500 resize-none"></textarea>
                        </div>

                        <button type="submit" id="submitBtn" class="w-full bg-blue-600 text-white font-bold py-4 rounded-xl hover:bg-blue-700 transition shadow-lg">
                            Submit Details
                        </button>
                    </div>
                </div>
            </form>
            <div id="msg" class="mt-6 text-center font-semibold"></div>
        </div>
    </section>

    <script>
        const scriptURL = 'https://script.google.com/macros/s/AKfycbzr27AzoZc7x1r7T0mMMI9ZBb5xZ-Kk_YC1B3r_uAwvZmzZWtpJ-Qco3ny1OH6GefArog/exec' 
        const form = document.getElementById('sahaytaForm')
        const roleSelect = document.getElementById('role')
        const formFields = document.getElementById('formFields')
        const detailInput = document.getElementById('detail')
        const charCount = document.getElementById('charCount')

        // Show fields & Update labels
        roleSelect.addEventListener('change', () => {
            if(roleSelect.value) {
                formFields.classList.remove('hidden');
                document.getElementById('detailLabel').innerText = roleSelect.value === 'Expert' ? 
                    "Your Expertise area*" : "The issues you face*";
            } else {
                formFields.classList.add('hidden');
            }
        });

        // Real-time character counter
        detailInput.addEventListener('input', () => {
            charCount.innerText = `${detailInput.value.length} / 500`;
        });

        // Manual validation check
        function validateForm() {
            let isValid = true;
            
            // Name check
            const name = document.getElementById('name');
            if(!name.checkValidity()) {
                document.getElementById('nameError').classList.remove('hidden');
                isValid = false;
            } else { document.getElementById('nameError').classList.add('hidden'); }

            // Contact check
            const contact = document.getElementById('contact');
            if(contact.value.length !== 10) {
                document.getElementById('contactError').classList.remove('hidden');
                isValid = false;
            } else { document.getElementById('contactError').classList.add('hidden'); }

            return isValid;
        }

        form.addEventListener('submit', e => {
            e.preventDefault()
            const msg = document.getElementById('msg')
            const submitBtn = document.getElementById('submitBtn')

            if (!validateForm()) {
                msg.style.color = "#dc2626";
                msg.innerHTML = "Please fix the errors in the form.";
                return;
            }

            submitBtn.disabled = true
            msg.style.color = "#1e3a8a"
            msg.innerHTML = "Submitting to Google Sheets..."
            
            fetch(scriptURL, { method: 'POST', body: new FormData(form)})
            .then(response => {
                msg.style.color = "#059669"
                msg.innerHTML = "âœ… Registration Successful!"
                form.reset()
                formFields.classList.add('hidden')
                charCount.innerText = "0 / 500"
                submitBtn.disabled = false
            })
            .catch(error => {
                msg.style.color = "#dc2626"
                msg.innerHTML = "Submission failed. Please try again."
                submitBtn.disabled = false
            })
        })
    </script>
</body>
</html>
